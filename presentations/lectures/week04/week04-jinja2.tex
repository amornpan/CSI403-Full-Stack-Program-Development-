% ============================================
% Week 4: Jinja2 Templates
% CSI403 Full Stack Development
% Date: January 28-30, 2026
% ============================================

\input{../../common/preamble}

\title[Week 4: Jinja2]{Week 4: Jinja2 Template Engine}
\subtitle{CSI403 Full Stack Development}
\date{January 28-30, 2026}

\begin{document}

\begin{frame}[plain]
    \titlepage
\end{frame}

\begin{frame}{Today's Agenda}
    \tableofcontents
\end{frame}

% ============================================
\section{Introduction to Jinja2}
% ============================================

\begin{frame}{What is Jinja2?}
    \weekheader{4}{Jan 28-30}
    
    \begin{block}{Jinja2 Template Engine}
        A modern, designer-friendly templating language for Python, modeled after Django's templates.
    \end{block}
    
    \vspace{0.5cm}
    
    \begin{center}
        \begin{tikzpicture}
            \node[rectangle, draw, thick, fill=codeblue!20, minimum width=2.5cm, minimum height=1.2cm] (template) at (0,0) {Template\\(.html)};
            \node[rectangle, draw, thick, fill=codegreen!20, minimum width=2.5cm, minimum height=1.2cm] (data) at (4,0) {Data\\(Python)};
            \node[rectangle, draw, thick, fill=spumaroon!20, minimum width=2.5cm, minimum height=1.2cm] (jinja) at (2,2) {Jinja2\\Engine};
            \node[rectangle, draw, thick, fill=codeorange!20, minimum width=2.5cm, minimum height=1.2cm] (output) at (2,-2) {HTML\\Output};
            
            \draw[->, thick] (template) -- (jinja);
            \draw[->, thick] (data) -- (jinja);
            \draw[->, thick] (jinja) -- (output);
        \end{tikzpicture}
    \end{center}
\end{frame}

\begin{frame}{Jinja2 Syntax Overview}
    \begin{center}
        \begin{tabular}{|l|l|l|}
            \hline
            \textbf{Type} & \textbf{Syntax} & \textbf{Purpose} \\
            \hline
            Variables & \texttt{\{\{ ... \}\}} & Output values \\
            \hline
            Statements & \texttt{\{\% ... \%\}} & Logic (if, for, block) \\
            \hline
            Comments & \texttt{\{\# ... \#\}} & Template comments \\
            \hline
        \end{tabular}
    \end{center}
    
    \vspace{0.5cm}
    
    \begin{codebox}[Quick Example]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{# This is a comment #}
<h1>Hello, {{ user.name }}!</h1>

{% if user.is_admin %}
    <p>Welcome, Administrator!</p>
{% else %}
    <p>Welcome, User!</p>
{% endif %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

% ============================================
\section{Variables & Filters}
% ============================================

\begin{frame}{Displaying Variables}
    \begin{codebox}[Python (FastAPI)]
        \begin{lstlisting}[style=python,basicstyle=\ttfamily\small]
@app.get("/loan/{loan_id}")
def show_loan(request: Request, loan_id: int):
    loan = {
        "id": loan_id,
        "amount": 100000,
        "borrower": "John Doe",
        "status": "current"
    }
    return templates.TemplateResponse(
        "loan.html", 
        {"request": request, "loan": loan}
    )
        \end{lstlisting}
    \end{codebox}
    
    \begin{codebox}[Template (loan.html)]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
<h1>Loan #{{ loan.id }}</h1>
<p>Amount: {{ loan.amount }} THB</p>
<p>Borrower: {{ loan.borrower }}</p>
<p>Status: {{ loan.status }}</p>
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Built-in Filters}
    \begin{codebox}[Common Filters]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{# Text filters #}
{{ name|upper }}          {# JOHN DOE #}
{{ name|lower }}          {# john doe #}
{{ name|title }}          {# John Doe #}
{{ name|capitalize }}     {# John doe #}
{{ text|truncate(50) }}   {# First 50 chars... #}

{# Number filters #}
{{ amount|round(2) }}     {# 100000.00 #}
{{ items|length }}        {# Count items #}

{# Default value #}
{{ email|default("N/A") }}

{# List filters #}
{{ loans|first }}         {# First item #}
{{ loans|last }}          {# Last item #}
{{ loans|sort(attribute="amount") }}
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Custom Filters for Currency}
    \begin{codebox}[Python - Register Filter]
        \begin{lstlisting}[style=python,basicstyle=\ttfamily\small]
from fastapi.templating import Jinja2Templates

templates = Jinja2Templates(directory="templates")

# Custom filter for Thai Baht formatting
def format_currency(value):
    return f"{value:,.2f} THB"

def format_date(value, format="%d/%m/%Y"):
    return value.strftime(format)

# Register filters
templates.env.filters["currency"] = format_currency
templates.env.filters["thaidate"] = format_date
        \end{lstlisting}
    \end{codebox}
    
    \begin{codebox}[Template Usage]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
<p>Amount: {{ loan.amount|currency }}</p>
{# Output: Amount: 100,000.00 THB #}

<p>Date: {{ loan.issue_date|thaidate }}</p>
{# Output: Date: 28/01/2026 #}
        \end{lstlisting}
    \end{codebox}
\end{frame}

% ============================================
\section{Control Structures}
% ============================================

\begin{frame}{If Statements}
    \begin{codebox}[Conditional Rendering]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{% if loan.status == "current" %}
    <span class="badge bg-success">Current</span>
{% elif loan.status == "late" %}
    <span class="badge bg-warning">Late</span>
{% elif loan.status == "default" %}
    <span class="badge bg-danger">Default</span>
{% else %}
    <span class="badge bg-secondary">Unknown</span>
{% endif %}

{# Check if variable exists #}
{% if user %}
    <p>Welcome, {{ user.name }}!</p>
{% else %}
    <p>Please login</p>
{% endif %}

{# Check if list is not empty #}
{% if loans %}
    {# show loans #}
{% endif %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{For Loops}
    \begin{codebox}[Iterating Over Lists]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
<table class="table">
    <thead>
        <tr>
            <th>#</th>
            <th>Amount</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for loan in loans %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ loan.amount|currency }}</td>
            <td>{{ loan.status }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="3">No loans found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Loop Variables}
    \begin{center}
        \begin{tabular}{|l|l|}
            \hline
            \textbf{Variable} & \textbf{Description} \\
            \hline
            \texttt{loop.index} & Current iteration (1-indexed) \\
            \texttt{loop.index0} & Current iteration (0-indexed) \\
            \texttt{loop.first} & True if first iteration \\
            \texttt{loop.last} & True if last iteration \\
            \texttt{loop.length} & Total number of items \\
            \texttt{loop.cycle()} & Cycle through values \\
            \hline
        \end{tabular}
    \end{center}
    
    \begin{codebox}[Alternating Row Colors]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{% for loan in loans %}
<tr class="{{ loop.cycle('bg-light', 'bg-white') }}">
    <td>{{ loop.index }} of {{ loop.length }}</td>
    <td>{{ loan.amount }}</td>
</tr>
{% endfor %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

% ============================================
\section{Template Inheritance}
% ============================================

\begin{frame}{Template Inheritance Concept}
    \begin{center}
        \begin{tikzpicture}[scale=0.8]
            % Base template
            \node[rectangle, draw, thick, fill=spumaroon!20, minimum width=8cm, minimum height=4cm] (base) at (0,0) {};
            \node[above] at (0,2.2) {\textbf{base.html}};
            
            % Header block
            \node[rectangle, draw, dashed, fill=codeblue!20, minimum width=7cm, minimum height=0.8cm] at (0,1.2) {Header (fixed)};
            
            % Content block
            \node[rectangle, draw, thick, fill=codegreen!30, minimum width=7cm, minimum height=1.5cm] at (0,0) {\texttt{\{\% block content \%\}}};
            
            % Footer block
            \node[rectangle, draw, dashed, fill=codeblue!20, minimum width=7cm, minimum height=0.8cm] at (0,-1.2) {Footer (fixed)};
            
            % Child templates
            \node[rectangle, draw, thick, fill=codeorange!30, minimum width=2.5cm, minimum height=1cm] (home) at (-3,-3.5) {home.html};
            \node[rectangle, draw, thick, fill=codeorange!30, minimum width=2.5cm, minimum height=1cm] (loans) at (0,-3.5) {loans.html};
            \node[rectangle, draw, thick, fill=codeorange!30, minimum width=2.5cm, minimum height=1cm] (profile) at (3,-3.5) {profile.html};
            
            % Arrows
            \draw[->, thick] (home) -- (0,-1.8);
            \draw[->, thick] (loans) -- (0,-1.8);
            \draw[->, thick] (profile) -- (0,-1.8);
            
            \node[below] at (0,-4.2) {Child templates extend base.html};
        \end{tikzpicture}
    \end{center}
\end{frame}

\begin{frame}{Base Template}
    \begin{codebox}[base.html]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\tiny]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Loan System{% endblock %}</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="/">Loan Management</a>
        {% block nav_items %}{% endblock %}
    </nav>
    
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>
    
    <footer class="bg-dark text-white text-center p-3">
        &copy; 2026 CSI403 Full Stack
    </footer>
    
    <script src="bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Child Template}
    \begin{codebox}[loans.html]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{% extends "base.html" %}

{% block title %}My Loans - Loan System{% endblock %}

{% block content %}
<h1>My Loans</h1>

<div class="row">
    {% for loan in loans %}
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5>{{ loan.amount|currency }}</h5>
                <p>Status: {{ loan.status }}</p>
                <a href="/loans/{{ loan.id }}" class="btn btn-primary">
                    View Details
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Block Override with Super}
    \begin{codebox}[Extending Block Content]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{# base.html #}
{% block sidebar %}
    <h3>Navigation</h3>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/loans">Loans</a></li>
    </ul>
{% endblock %}

{# admin.html - extends base.html #}
{% block sidebar %}
    {{ super() }}  {# Include parent content #}
    
    <h3>Admin Menu</h3>
    <ul>
        <li><a href="/admin/users">Users</a></li>
        <li><a href="/admin/reports">Reports</a></li>
    </ul>
{% endblock %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

% ============================================
\section{Includes \& Macros}
% ============================================

\begin{frame}{Include Statement}
    \begin{codebox}[Reusable Components]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{# components/loan_card.html #}
<div class="card">
    <div class="card-header">Loan #{{ loan.id }}</div>
    <div class="card-body">
        <p>Amount: {{ loan.amount|currency }}</p>
        <p>Status: {{ loan.status }}</p>
    </div>
</div>

{# loans.html #}
<div class="row">
    {% for loan in loans %}
    <div class="col-md-4">
        {% include "components/loan_card.html" %}
    </div>
    {% endfor %}
</div>
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Macros - Reusable Functions}
    \begin{codebox}[macros/forms.html]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\tiny]
{% macro input(name, label, type="text", value="", required=false) %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <input type="{{ type }}" 
           class="form-control" 
           id="{{ name }}" 
           name="{{ name }}"
           value="{{ value }}"
           {% if required %}required{% endif %}>
</div>
{% endmacro %}

{% macro select(name, label, options, selected="") %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <select class="form-select" id="{{ name }}" name="{{ name }}">
        {% for value, text in options %}
        <option value="{{ value }}" {% if value == selected %}selected{% endif %}>
            {{ text }}
        </option>
        {% endfor %}
    </select>
</div>
{% endmacro %}
        \end{lstlisting}
    \end{codebox}
\end{frame}

\begin{frame}{Using Macros}
    \begin{codebox}[apply\_loan.html]
        \begin{lstlisting}[style=html,basicstyle=\ttfamily\small]
{% from "macros/forms.html" import input, select %}

<form method="POST" action="/loans/apply">
    {{ input("name", "Full Name", required=true) }}
    
    {{ input("amount", "Loan Amount", type="number", required=true) }}
    
    {{ input("income", "Annual Income", type="number") }}
    
    {{ select("term", "Loan Term", [
        ("12", "12 months"),
        ("24", "24 months"),
        ("36", "36 months"),
        ("48", "48 months"),
        ("60", "60 months")
    ]) }}
    
    <button type="submit" class="btn btn-primary">Apply</button>
</form>
        \end{lstlisting}
    \end{codebox}
\end{frame}

% ============================================
\section{Summary}
% ============================================

\begin{frame}{Week 4 Summary}
    \begin{columns}[T]
        \begin{column}{0.48\textwidth}
            \begin{block}{What We Learned}
                \begin{itemize}
                    \item[$\checkmark$] Jinja2 syntax
                    \item[$\checkmark$] Variables \& filters
                    \item[$\checkmark$] If/else statements
                    \item[$\checkmark$] For loops
                    \item[$\checkmark$] Template inheritance
                    \item[$\checkmark$] Includes \& macros
                \end{itemize}
            \end{block}
        \end{column}
        \begin{column}{0.48\textwidth}
            \begin{alertblock}{Lab Assignment}
                Create templates for:
                \begin{itemize}
                    \item base.html with nav
                    \item home.html
                    \item loans/list.html
                    \item loans/detail.html
                    \item auth/login.html
                \end{itemize}
            \end{alertblock}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Next Week Preview}
    \begin{block}{Week 5: FastAPI Introduction}
        \begin{itemize}
            \item FastAPI basics \& routing
            \item Path \& query parameters
            \item Request/Response handling
            \item Swagger UI documentation
            \item Connecting templates with routes
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}[plain]
    \begin{center}
        \vspace{2cm}
        {\Huge\bfseries\color{spumaroon} Questions?}
        \vspace{1cm}
        
        {\Large Thank you!}
        \vspace{1cm}
        
        \includegraphics[height=1cm]{spu_logo.png}
    \end{center}
\end{frame}

\end{document}
